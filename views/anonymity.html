{{template "_head.html" .}}

<style type="text/css">

#log {
    background: white;
    margin: 0;
    padding: 0.5em 0.5em 0.5em 0.5em;
   height: 50%;
    top: 0.5em;
    left: 0.5em;
    right: 0.5em;
    bottom: 3em;
    overflow: auto;
}

#show {
    background: white;
    margin: 0;
    padding: 0.5em 0.5em 0.5em 0.5em;
   height: 50%;
    top: 0.5em;
    left: 0.5em;
    right: 0.5em;
    bottom: 3em;
    overflow: auto;
}

#form {
    padding: 0 0.5em 0 0.5em;
    margin: 0;
   
    bottom: 1em;
    left: 0px;
    width: 100%;
    overflow: hidden;
}

</style>
</head>
<body ontouchstart="" >
<div style="width: 100%;height: 48px;background-color: #ddd;">
    <a href="/"><span style="font-size: 32px;margin-left: 5%;"> < </span></a>
    <span style="font-size: 26px; margin-left: 5%;" id="num_title" > 匿名聊天室 {{.number}}人 </span>
</div>

<div class="weui-cells__title">消息</div>

<div id="show"></div>
<form >
    <div class="weui-cells weui-cells_form" style="">
      <div class="weui-cell">
        <div class="weui-cell__bd">
          <textarea class="weui-textarea" id="msg" placeholder="请输入文本" rows="3"></textarea>
          <div class="weui-textarea-counter"><span>0</span>/200</div>
        </div>
      </div>
    </div>
    <div class="weui-flex" style="margin-top:21px;">
          <div class="weui-flex__item" >
              <a id="form" class="weui-btn weui-btn_primary" style="height: 38px;">发送</a>
          </div>
      </div>
</form>

{{template "_js.html" .}}
<script type="text/javascript">

window.onload = function () {
    var conn;
    var msg = document.getElementById("msg");
    var log = document.getElementById("log");

    $("#form").click(function () {
        if (!conn) {
            return false;
        }
        if (!msg.value) {
            return false;
        }
        conn.send(msg.value);
        msg.value = "";
        return false;
    });
    
    if (window["WebSocket"]) {
        var name = "{{.name}}";
        conn = new WebSocket("ws://" + document.location.host + "/ws/anonymity?name="+name);
        conn.onclose = function (evt) {
            appendErr("<b>Connection closed. 连接断开</b>");
        };
        conn.onmessage = function (evt) {
            var messages = evt.data.split('\n');
            var obj = JSON.parse(messages);
            $("#num_title").empty();
            $("#num_title").append("匿名聊天室 "+obj["count"]+"人 ")

            if (name == obj["name"]){
                MyShow(obj["data"], obj["time"]);
            }else{
                YouShow(obj["data"], obj["name"], obj["time"]);
            }
        };
    } else {
        appendErr("<b>你当前使用的浏览器不支持即使聊天，请更新或更换浏览器.</b>");
    }
};
</script>

</body>
</html>

